<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Newton & Gravity</title>
    
    <style>
        body { margin: 0; text-align: center; font-family: Arial; background: #b0e2ff; overflow: hidden; }
        h2 { margin: 10px 0; color: #1b4d3e; }
        
        canvas { 
            display: block; 
            margin: auto; 
            width: 95%; 
            max-width: 520px; 
            background: transparent;
            touch-action: none;
        }

        #controls { display: flex; justify-content: center; gap: 20px; margin-top: 15px; }
        @media (hover: hover) and (pointer: fine) { #controls { display: none; } }

        #leftBtn, #rightBtn {
            width: 70px; height: 70px; border-radius: 50%;
            border: 3px solid #ffe066; color: white;
            font-size: 30px; background: radial-gradient(circle at 30% 30%, #ff6b6b, #800000 80%);
            box-shadow: 0 6px 0 #550000; cursor: pointer;
            outline: none; -webkit-tap-highlight-color: transparent;
        }

        .restart-btn {
            margin-top: 15px; font-size: 18px; padding: 10px 25px; 
            border-radius: 12px; border: 3px solid #ffe066;
            background: linear-gradient(#ff4d4d, #990000); color: white;
            box-shadow: 0 5px #550000; cursor: pointer;
        }

        #leftBtn:active, #rightBtn:active, .restart-btn:active { transform: translateY(4px); box-shadow: 0 2px #330000; }
    </style>
</head>

<body>
    <h2>üçé Mini Newton üçé</h2>
    <canvas id="game" width="620" height="620"></canvas>

    <div id="mobile-ui">
        <div id="controls">
            <button id="leftBtn">‚óÄ</button>
            <button id="rightBtn">‚ñ∂</button>
        </div>
        <button class="restart-btn" onclick="restartGame()">Restart Game</button>
    </div>

    <script>
        const canvas = document.getElementById("game");
        const ctx = canvas.getContext("2d");

        // --- BORDER BOUNDARIES (Adjusted for your emerald frame) ---
        const BORDER_LEFT = 60;
        const BORDER_RIGHT = 560;

        const borderImg = new Image(); borderImg.src = 'border.png';
        const backgroundImg = new Image(); backgroundImg.src = 'background.png';
        const newtonImg = new Image(); newtonImg.src = 'newton.png';
        const bombImg = new Image(); bombImg.src = 'bomb.png';

        let newtonX = 225;
        let appleX = 300;
        let appleY = -20;
        let score = 0;
        let speed = 5;
        let gameOver = false;
        let isGolden = false;
        let bombs = [];
        let particles = [];
        const keys = { left: false, right: false };

        // --- DRAWING ---
        function drawBackground() {
            // FIXED PARALLAX: background is drawn wider than canvas and offset slightly
            // We use a clamp to ensure the background edges never enter the frame
            let bgShift = (canvas.width / 2 - newtonX) * 0.15;
            ctx.drawImage(backgroundImg, -50 + bgShift, 0, canvas.width + 100, canvas.height);
        }

        function drawNewton() {
            // Newton Hitbox visualization (hidden) is roughly 170px wide
            // Center of newton is roughly newtonX + 85
            ctx.drawImage(newtonImg, newtonX, 370, 170, 195); 
        }

        function resetApple() {
            appleY = 80; // Start inside the top of the frame
            // Ensure apple spawns inside the emerald border area
            appleX = BORDER_LEFT + 40 + Math.random() * (BORDER_RIGHT - BORDER_LEFT - 80);
            isGolden = Math.random() < 0.2;
        }

        function spawnBomb() {
            if (Math.random() < 0.01) {
                let potentialX = BORDER_LEFT + 40 + Math.random() * (BORDER_RIGHT - BORDER_LEFT - 80);
                
                // FAIRNESS CHECK: If bomb is too close to the current apple, don't spawn it
                // This prevents "impossible" scenarios
                let distToApple = Math.abs(potentialX - appleX);
                if (distToApple > 100) {
                    bombs.push({ x: potentialX, y: -50, speed: 4 + Math.random() * 2 });
                }
            }
        }

        // --- CONTROLS ---
        document.addEventListener("keydown", (e) => {
            if (e.key === "ArrowLeft") keys.left = true;
            if (e.key === "ArrowRight") keys.right = true;
        });
        document.addEventListener("keyup", (e) => {
            if (e.key === "ArrowLeft") keys.left = false;
            if (e.key === "ArrowRight") keys.right = false;
        });

        const leftBtn = document.getElementById("leftBtn");
        const rightBtn = document.getElementById("rightBtn");
        leftBtn.onpointerdown = (e) => { e.preventDefault(); keys.left = true; };
        leftBtn.onpointerup = () => keys.left = false;
        rightBtn.onpointerdown = (e) => { e.preventDefault(); keys.right = true; };
        rightBtn.onpointerup = () => keys.right = false;

        function restartGame() {
            score = 0; speed = 5; gameOver = false;
            bombs = []; newtonX = 225;
            resetApple(); gameLoop();
        }

        function gameLoop() {
            if (gameOver) {
                ctx.fillStyle = "rgba(0,0,0,0.7)";
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = "white"; ctx.textAlign = "center";
                ctx.font = "bold 40px Arial"; ctx.fillText("GAME OVER", canvas.width/2, 300);
                ctx.drawImage(borderImg, 0, 0, canvas.width, canvas.height);
                return;
            }

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBackground();

            // 1. Move Newton (Stay inside border)
            if (keys.left && newtonX > BORDER_LEFT - 40) newtonX -= 10;
            if (keys.right && newtonX < BORDER_RIGHT - 130) newtonX += 10;

            // 2. Newton & Apple
            drawNewton();
            
            // Draw Apple
            ctx.fillStyle = isGolden ? "gold" : "red";
            ctx.beginPath(); ctx.arc(appleX, appleY, 15, 0, Math.PI*2); ctx.fill();

            // 3. Bombs
            spawnBomb();
            for (let i = bombs.length - 1; i >= 0; i--) {
                let b = bombs[i];
                b.y += b.speed;
                ctx.drawImage(bombImg, b.x, b.y, 45, 45);
                
                // Bomb Collision
                if (b.y > 400 && b.y < 500 && Math.abs((b.x + 22) - (newtonX + 85)) < 50) {
                    gameOver = true;
                }
                if (b.y > canvas.height) bombs.splice(i, 1);
            }

            // 4. Scoring logic
            appleY += speed;
            if (appleY > 400 && appleY < 520 && Math.abs(appleX - (newtonX + 85)) < 60) {
                score += isGolden ? 5 : 1;
                resetApple();
            }
            if (appleY > canvas.height - 60) gameOver = true;

            // 5. UI & Border
            ctx.fillStyle = "#FFD700"; ctx.font = "bold 24px Arial"; ctx.textAlign = "left";
            ctx.fillText("Score: " + score, 80, 100);

            // Draw Border last so it's on top
            ctx.drawImage(borderImg, 0, 0, canvas.width, canvas.height);

            requestAnimationFrame(gameLoop);
        }

        resetApple();
        gameLoop();
    </script>
</body>
</html>
